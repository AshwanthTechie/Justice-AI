<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dropdown Search Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .demo-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: #2c2c2c;
        }
        .demo-section h3 {
            color: white;
            margin-top: 0;
        }
        .search-demo {
            position: relative;
            width: 100%;
            max-width: 400px;
        }
        .search-input-wrapper {
            position: relative;
            display: flex;
            align-items: center;
            background: #2a2a2a;
            border: 1px solid #444;
            border-radius: 8px;
            padding: 0 12px;
        }
        .search-input {
            flex: 1;
            background: transparent;
            border: none;
            outline: none;
            color: #fff;
            font-size: 14px;
            padding: 10px 0;
        }
        .search-input::placeholder {
            color: #888;
        }
        .search-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: #1e1e1e;
            border: 1px solid #444;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            z-index: 1000;
            max-height: 300px;
            overflow-y: auto;
            margin-top: 4px;
        }
        .dropdown-item {
            padding: 12px;
            border-bottom: 1px solid #333;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }
        .dropdown-item:hover {
            background: #2a2a2a;
        }
        .case-title {
            color: #fff;
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 4px;
        }
        .case-meta {
            display: flex;
            gap: 12px;
            margin-bottom: 6px;
            font-size: 12px;
        }
        .case-court {
            color: #007acc;
        }
        .case-date {
            color: #888;
        }
        .case-snippet {
            color: #ccc;
            font-size: 12px;
            line-height: 1.4;
        }
        .instructions {
            background: #e8f4fd;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
        }
        .feature-list {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
            margin-top: 20px;
        }
        .feature-list ul {
            margin: 0;
            padding-left: 20px;
        }
        .feature-list li {
            margin-bottom: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Dropdown Search Component - Test & Demo</h1>
        <div class="instructions">
            <strong>Instructions:</strong>
            <ol>
                <li>Make sure your backend is running on <code>http://localhost:7777</code></li>
                <li>Ensure you have sample case data in your database</li>
                <li>Type in the search box below to see dropdown results</li>
                <li>Click on any result to select it</li>
            </ol>
        </div>
    </div>

    <div class="container">
        <div class="demo-section">
            <h3>Live Search Demo</h3>
            <div class="search-demo">
                <div class="search-input-wrapper">
                    <input 
                        type="text" 
                        class="search-input" 
                        placeholder="Search Indian Kanoon cases..."
                        id="searchInput"
                    >
                </div>
                <div class="search-dropdown" id="searchDropdown" style="display: none;">
                    <!-- Results will be populated here -->
                </div>
            </div>
            <div id="selectedCase" style="margin-top: 20px; color: white;"></div>
        </div>
    </div>

    <div class="container">
        <div class="feature-list">
            <h3>Features Demonstrated:</h3>
            <ul>
                <li><strong>Real-time Search:</strong> Results appear as you type (300ms debounce)</li>
                <li><strong>Dropdown Display:</strong> Results shown in a clean dropdown format</li>
                <li><strong>Case Information:</strong> Title, court, date, and snippet displayed</li>
                <li><strong>Click to Select:</strong> Click any result to select it</li>
                <li><strong>Keyboard Navigation:</strong> Use arrow keys to navigate, Enter to select</li>
                <li><strong>Auto-close:</strong> Dropdown closes when clicking outside</li>
                <li><strong>Loading States:</strong> Shows loading indicator during search</li>
                <li><strong>Error Handling:</strong> Displays error messages when search fails</li>
            </ul>
        </div>
    </div>

    <div class="container">
        <h3>Sample Test Queries:</h3>
        <p>Try searching for these terms if you have sample data:</p>
        <ul>
            <li><code>contract</code> - Should find contract-related cases</li>
            <li><code>TEST001</code> - Should find specific test case</li>
            <li><code>Delhi High Court</code> - Should find cases from Delhi High Court</li>
            <li><code>employment</code> - Should find employment-related cases</li>
            <li><code>property</code> - Should find property-related cases</li>
        </ul>
    </div>

    <script>
        const BASE_URL = 'http://localhost:7777';
        let debounceTimer = null;

        const searchInput = document.getElementById('searchInput');
        const searchDropdown = document.getElementById('searchDropdown');
        const selectedCase = document.getElementById('selectedCase');

        // Mock data for demonstration (in case backend is not available)
        const mockResults = [
            {
                id: 'TEST001',
                title: 'Contract Dispute - ABC Corp vs XYZ Ltd',
                court: 'Delhi High Court',
                date: '2023-01-15',
                snippet: 'A dispute regarding breach of contract terms and conditions between two companies'
            },
            {
                id: 'TEST002',
                title: 'Employment Contract Violation - Worker vs Company',
                court: 'Mumbai High Court',
                date: '2023-02-20',
                snippet: 'Employee termination without proper notice period as per contract'
            },
            {
                id: 'TEST003',
                title: 'Property Purchase Contract Issues - Buyer vs Builder',
                court: 'Bangalore High Court',
                date: '2023-03-10',
                snippet: 'Real estate contract cancellation dispute over delayed possession'
            }
        ];

        async function searchCases(query) {
            try {
                const response = await fetch(`${BASE_URL}/api/cases/search?query=${encodeURIComponent(query)}`);
                if (response.ok) {
                    const data = await response.json();
                    return Array.isArray(data) ? data.slice(0, 5) : [];
                } else {
                    console.warn('Backend not available, using mock data');
                    return mockResults.filter(item => 
                        item.title.toLowerCase().includes(query.toLowerCase()) ||
                        item.court.toLowerCase().includes(query.toLowerCase()) ||
                        item.snippet.toLowerCase().includes(query.toLowerCase())
                    );
                }
            } catch (error) {
                console.warn('Backend not available, using mock data');
                return mockResults.filter(item => 
                    item.title.toLowerCase().includes(query.toLowerCase()) ||
                    item.court.toLowerCase().includes(query.toLowerCase()) ||
                    item.snippet.toLowerCase().includes(query.toLowerCase())
                );
            }
        }

        function displayResults(results) {
            if (results.length === 0) {
                searchDropdown.innerHTML = '<div style="padding: 12px; color: #888; text-align: center;">No cases found</div>';
                searchDropdown.style.display = 'block';
                return;
            }

            const html = results.map(item => `
                <div class="dropdown-item" onclick="selectCase('${item.id}', '${item.title.replace(/'/g, "\\'")}', '${item.court}')">
                    <div class="case-title">${item.title}</div>
                    <div class="case-meta">
                        <span class="case-court">${item.court}</span>
                        <span class="case-date">${item.date}</span>
                    </div>
                    <div class="case-snippet">${item.snippet}</div>
                </div>
            `).join('');

            searchDropdown.innerHTML = html;
            searchDropdown.style.display = 'block';
        }

        function selectCase(id, title, court) {
            selectedCase.innerHTML = `
                <strong>Selected Case:</strong><br>
                <strong>ID:</strong> ${id}<br>
                <strong>Title:</strong> ${title}<br>
                <strong>Court:</strong> ${court}
            `;
            searchDropdown.style.display = 'none';
            searchInput.value = '';
        }

        searchInput.addEventListener('input', function(e) {
            const query = e.target.value.trim();
            
            if (debounceTimer) {
                clearTimeout(debounceTimer);
            }

            if (!query) {
                searchDropdown.style.display = 'none';
                return;
            }

            debounceTimer = setTimeout(async () => {
                searchDropdown.innerHTML = '<div style="padding: 12px; color: #888; text-align: center;">Searching...</div>';
                searchDropdown.style.display = 'block';
                
                const results = await searchCases(query);
                displayResults(results);
            }, 300);
        });

        // Close dropdown when clicking outside
        document.addEventListener('click', function(e) {
            if (!e.target.closest('.search-demo')) {
                searchDropdown.style.display = 'none';
            }
        });

        // Handle keyboard navigation
        searchInput.addEventListener('keydown', function(e) {
            const items = searchDropdown.querySelectorAll('.dropdown-item');
            let selectedIndex = -1;
            
            // Find currently selected item
            items.forEach((item, index) => {
                if (item.classList.contains('selected')) {
                    selectedIndex = index;
                }
            });

            switch (e.key) {
                case 'ArrowDown':
                    e.preventDefault();
                    if (selectedIndex < items.length - 1) {
                        if (selectedIndex >= 0) items[selectedIndex].classList.remove('selected');
                        items[selectedIndex + 1].classList.add('selected');
                    }
                    break;
                case 'ArrowUp':
                    e.preventDefault();
                    if (selectedIndex > 0) {
                        items[selectedIndex].classList.remove('selected');
                        items[selectedIndex - 1].classList.add('selected');
                    }
                    break;
                case 'Enter':
                    e.preventDefault();
                    if (selectedIndex >= 0) {
                        items[selectedIndex].click();
                    }
                    break;
                case 'Escape':
                    searchDropdown.style.display = 'none';
                    break;
            }
        });

        console.log('Dropdown search test page loaded. Try typing in the search box!');
    </script>
</body>
</html>